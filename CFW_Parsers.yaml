parsers: # array
  - reg: ".+"
    code: |
      module.exports.parse = (raw, { yaml }) => {
        const rawObj = yaml.parse(raw)
        const groups = []
        const rules = []
        return yaml.stringify({ ...rawObj, 'proxy-groups': groups, rules})
      } 
    yaml:
      mix-object:
        dns:
          enable: true
          listen: :53
          enhanced-mode: fake-ip
          allow-lan: false
          mode: Rule
          log-level: warning
          external-controller: 127.0.0.1:9090
          nameserver:
            - https://1.12.12.12/dns-query
            - https://223.5.5.5/dns-query
          fallback: []     
      prepend-proxy-groups:
        - name: iLatency
          type: url-test
          proxies:
            - DIRECT
          url: http://www.gstatic.com/generate_204
          interval: 300
        - name: iFallback
          type: fallback
          proxies:
            - DIRECT
          url: http://www.gstatic.com/generate_204
          interval: 900
        - name: iProxy
          type: select
          proxies:
            - DIRECT
        - name: iProxyUS
          type: url-test
          proxies:
            - DIRECT
          url: http://www.gstatic.com/generate_204
          interval: 300
        - name: iProxyJP
          type: url-test
          proxies:
            - DIRECT
          url: http://www.gstatic.com/generate_204
          interval: 300
        - name: iProxyKR
          type: url-test
          proxies:
            - DIRECT
          url: http://www.gstatic.com/generate_204
          interval: 300
        - name: iProxySG
          type: url-test
          proxies:
            - DIRECT
          url: http://www.gstatic.com/generate_204
          interval: 300
        - name: iProxyHK
          type: url-test
          proxies:
            - DIRECT
          url: http://www.gstatic.com/generate_204
          interval: 300
        - name: iProxyTW
          type: url-test
          proxies:
            - DIRECT
          url: http://www.gstatic.com/generate_204
          interval: 300
        - name: iSwitchyProxy
          type: select
          proxies:
            - iLatency
            - iFallback
            - iProxy
        - name: iSwitchyDirect
          type: select
          proxies:
            - DIRECT
            - iSwitchyProxy
        - name: iSwitchyFinal
          type: select
          proxies:
            - iSwitchyHK_TW
            - iSwitchyProxy
            - iSwitchyDirect
        - name: iSwitchyUS_JP_KR_SG
          type: select
          proxies:
            - iProxyJP
            - iProxyKR
            - iProxySG
            - iProxyUS
        - name: iSwitchyHK_TW
          type: select
          proxies:
            - iProxyHK
            - iProxyTW
        - name: iSwitchyBilbili
          type: select
          proxies:
            - iSwitchyDirect
            - iSwitchyHK_TW
        - name: iSwitchyNetflix
          type: select
          proxies:
            - iSwitchyHK_TW
            - iSwitchyUS_JP_KR_SG
            - iProxy
        - name: iSwitchyService
          type: select
          proxies:
            - iSwitchyDirect
            - iSwitchyHK_TW
      commands:
        - proxy-groups.iLatency.proxies=[]proxyNames|^((?!Ââ©‰Ωô|ÈáçÁΩÆ|Âà∞Êúü|Â•óÈ§ê).)*$
        - proxy-groups.iFallback.proxies=[]proxyNames|^((?!Ââ©‰Ωô|ÈáçÁΩÆ|Âà∞Êúü|Â•óÈ§ê).)*$
        - proxy-groups.iProxy.proxies=[]proxyNames|^((?!Ââ©‰Ωô|ÈáçÁΩÆ|Âà∞Êúü|Â•óÈ§ê).)*$
        - proxy-groups.iProxyUS.proxies=[]proxyNames|(Áæé|Ê≥¢ÁâπÂÖ∞|ËææÊãâÊñØ|‰øÑÂãíÂÜà|Âá§Âá∞Âüé|Ë¥πÂà©Ëíô|Á°ÖË∞∑|ÊãâÊñØÁª¥Âä†ÊñØ|Ê¥õÊùâÁü∂|Âú£‰ΩïÂ°û|Âú£ÂÖãÊãâÊãâ|Ë•øÈõÖÂõæ|ËäùÂä†Âì•|US|United States)
        - proxy-groups.iProxyJP.proxies=[]proxyNames|(Êó•Êú¨|Â∑ùÊó•|‰∏ú‰∫¨|Â§ßÈò™|Ê≥âÊó•|ÂüºÁéâ|Ê≤™Êó•|Ê∑±Êó•|[^-]Êó•|JP|Japan)
        - proxy-groups.iProxyKR.proxies=[]proxyNames|(KR|Korea|KOR|È¶ñÂ∞î|Èü©|Èüì)
        - proxy-groups.iProxySG.proxies=[]proxyNames|(Êñ∞Âä†Âù°|Âù°|ÁãÆÂüé|SG|Singapore)
        - proxy-groups.iProxyHK.proxies=[]proxyNames|(È¶ôÊ∏Ø|HK|Hong|üá≠üá∞)
        - proxy-groups.iProxyTW.proxies=[]proxyNames|(Âè∞|Êñ∞Âåó|ÂΩ∞Âåñ|TW|Taiwan)
      mix-rule-providers:
        icloud:
          type: http
          behavior: domain
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt"
          path: ./ruleset/icloud.yaml
          interval: 86400
        apple:
          type: http
          behavior: domain
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt"
          path: ./ruleset/apple.yaml
          interval: 86400
        proxy:
          type: http
          behavior: domain
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt"
          path: ./ruleset/proxy.yaml
          interval: 86400
        direct:
          type: http
          behavior: domain
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt"
          path: ./ruleset/direct.yaml
          interval: 86400
        private:
          type: http
          behavior: domain
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt"
          path: ./ruleset/private.yaml
          interval: 86400
        cncidr:
          type: http
          behavior: ipcidr
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt"
          path: ./ruleset/cncidr.yaml
          interval: 86400
        lancidr:
          type: http
          behavior: ipcidr
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt"
          path: ./ruleset/lancidr.yaml
          interval: 86400
        applications:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt"
          path: ./ruleset/applications.yaml
          interval: 86400
        bilibili:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/BiliBili/BiliBili.yaml"
          path: ./ruleset/bilibili.yaml
          interval: 86400
        netflix:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Netflix/Netflix_Classical.yaml"
          path: ./ruleset/netflix.yaml
          interval: 86400
        Microsoft:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Microsoft/Microsoft.yaml"
          path: ./ruleset/Microsoft.yaml
          interval: 86400
      prepend-rules:
#        - PROCESS-NAME,ÂìîÂì©ÂìîÂì©.exe,iSwitchyHK_TW
        - RULE-SET,applications,iSwitchyDirect
        - DOMAIN-SUFFIX,beanfun.com,iSwitchyHK_TW
        - DOMAIN-SUFFIX,openai.com,iSwitchyUS_JP_KR_SG
        - DOMAIN-SUFFIX,openstack.org,iSwitchyUS_JP_KR_SG
        - DOMAIN-SUFFIX,bing.com,iSwitchyUS_JP_KR_SG
        - RULE-SET,private,iSwitchyDirect
        - RULE-SET,icloud,iSwitchyService
        - RULE-SET,apple,iSwitchyService
        - RULE-SET,Microsoft,iSwitchyService
        - RULE-SET,netflix,iSwitchyNetflix
        - RULE-SET,bilibili,iSwitchyBilbili
        - RULE-SET,proxy,iSwitchyProxy
        - RULE-SET,direct,iSwitchyDirect
        - RULE-SET,lancidr,iSwitchyDirect
        - RULE-SET,cncidr,iSwitchyDirect
        - GEOIP,CN,iSwitchyDirect
        - MATCH,iSwitchyFinal
