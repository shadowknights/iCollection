parsers: # array
  - reg: ".+"
    code: |
      module.exports.parse = (raw, { yaml }) => {
        const rawObj = yaml.parse(raw)
        const groups = []
        const rules = []
        return yaml.stringify({ ...rawObj, 'proxy-groups': groups, rules})
      } 
    yaml:
      prepend-proxy-groups:
        - name: iLatency
          type: url-test
          proxies:
            - DIRECT
          url: http://www.gstatic.com/generate_204
          interval: 300
        - name: iFallback
          type: fallback
          proxies:
            - DIRECT
          url: http://www.gstatic.com/generate_204
          interval: 900
        - name: iProxy
          type: select
          proxies:
            - DIRECT
        - name: iProxyUS_JP_KR
          type: select
          proxies:
            - DIRECT
        - name: iProxyHK_TW
          type: select
          proxies:
            - DIRECT
        - name: iSwitchyProxy
          type: select
          proxies:
            - iLatency
            - iFallback
            - iProxy
        - name: iSwitchyDirect
          type: select
          proxies:
            - DIRECT
            - iSwitchyProxy
        - name: iSwitchyFinal
          type: select
          proxies:
            - iSwitchyDirect
            - iSwitchyProxy
        - name: iSwitchyUS_JP_KR
          type: select
          proxies:
            - iProxyUS_JP_KR
            - iSwitchyDirect
            - iSwitchyProxy
        - name: iSwitchyHK_TW
          type: select
          proxies:
            - iProxyHK_TW
            - iSwitchyDirect
            - iSwitchyProxy
        - name: iSwitchyBilbili
          type: select
          proxies:
            - iSwitchyDirect
            - iProxy
        - name: iSwitchyNetflix
          type: select
          proxies:
            - iSwitchyDirect
            - iProxy
      mix-rule-providers:
        icloud:
          type: http
          behavior: domain
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt"
          path: ./ruleset/icloud.yaml
          interval: 86400
        apple:
          type: http
          behavior: domain
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt"
          path: ./ruleset/apple.yaml
          interval: 86400
        proxy:
          type: http
          behavior: domain
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt"
          path: ./ruleset/proxy.yaml
          interval: 86400
        direct:
          type: http
          behavior: domain
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt"
          path: ./ruleset/direct.yaml
          interval: 86400
        private:
          type: http
          behavior: domain
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt"
          path: ./ruleset/private.yaml
          interval: 86400
        cncidr:
          type: http
          behavior: ipcidr
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt"
          path: ./ruleset/cncidr.yaml
          interval: 86400
        lancidr:
          type: http
          behavior: ipcidr
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt"
          path: ./ruleset/lancidr.yaml
          interval: 86400
        applications:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt"
          path: ./ruleset/applications.yaml
          interval: 86400
        bilibili:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/BiliBili/BiliBili.yaml"
          path: ./ruleset/bilibili.yaml
          interval: 86400
        netflix:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Netflix/Netflix_Classical.yaml"
          path: ./ruleset/netflix.yaml
          interval: 86400
        Microsoft:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Microsoft/Microsoft.yaml"
          path: ./ruleset/Microsoft.yaml
          interval: 86400
      mix-object:
        dns:
          enable: true
          listen: :53
          enhanced-mode: fake-ip
          allow-lan: false
          mode: Rule
          log-level: warning
          external-controller: 127.0.0.1:9090
          nameserver:
            - https://1.12.12.12/dns-query
            - https://223.5.5.5/dns-query
          fallback: []
      commands:
        - proxy-groups.iLatency.proxies=[]proxyNames|^((?!剩余|重置|到期|套餐).)*$
        - proxy-groups.iFallback.proxies=[]proxyNames|^((?!剩余|重置|到期|套餐).)*$
        - proxy-groups.iProxy.proxies=[]proxyNames|^((?!剩余|重置|到期|套餐).)*$
        - proxy-groups.iProxyUS_JP_KR.proxies=[]proxyNames|^((?!剩余|重置|到期|套餐).)*$
        - proxy-groups.iProxyHK_TW.proxies=[]proxyNames|^((?!剩余|重置|到期|套餐).)*$
      prepend-rules:
#        - PROCESS-NAME,哔哩哔哩.exe,iSwitchyHK_TW
        - RULE-SET,applications,iSwitchyDirect
        - DOMAIN-SUFFIX,beanfun.com,iSwitchyHK_TW
        - DOMAIN-SUFFIX,openai.com,iSwitchyUS_JP_KR
        - DOMAIN-SUFFIX,openstack.org,iSwitchyUS_JP_KR
        - DOMAIN-SUFFIX,bing.com,iSwitchyUS_JP_KR
        - RULE-SET,private,iSwitchyDirect
        - RULE-SET,icloud,iSwitchyDirect
        - RULE-SET,apple,iSwitchyDirect
        - RULE-SET,Microsoft,iSwitchyDirect
        - RULE-SET,netflix,iSwitchyNetflix
        - RULE-SET,bilibili,iSwitchyBilbili
        - RULE-SET,proxy,iSwitchyProxy
        - RULE-SET,direct,iSwitchyDirect
        - RULE-SET,lancidr,iSwitchyDirect
        - RULE-SET,cncidr,iSwitchyDirect
        - GEOIP,CN,iSwitchyDirect
        - MATCH,iSwitchyFinal
